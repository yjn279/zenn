---
title: "LangChain.jsã®File Loadersã§ä»»æ„ã®æ‹¡å¼µå­ã«å¯¾å¿œã™ã‚‹"
emoji: "ğŸ¦œ"
type: "tech"
topics:
  - "langchain"
  - "javascript"
  - "typescript"
  - "llm"
  - "openai"
published: true
published_at: "2024-08-05 08:00"
---

## ã¯ã˜ã‚ã«

ã¨ã†ã¨ã†ç¤¾ä¼šäºº2å¹´ç”Ÿã«ãªã£ã¦ã—ã¾ã£ãŸwinnieã§ã™ ğŸ¯

å°‘ã—å‰ã‹ã‚‰PMè¦‹ç¿’ã„ã¨ã—ã¦å®Ÿè£…ã¨é›¢ã‚ŒãŸç”Ÿæ´»ã‚’é€ã£ã¦ã„ã¾ã—ãŸãŒã€æœ€è¿‘ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§æºã‚ã£ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§æœ¬æ ¼çš„ã«LLMã¾ã‚ã‚Šã®æŠ€è¡“ã‚’è§¦ã‚Šå§‹ã‚ãŸã®ã§ã€ä¹…ã—ã¶ã‚Šã«å®Ÿè£…é–¢é€£ã®çŸ¥è¦‹ã‚’ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ï¼

## å›°ã£ãŸã“ã¨

RAGãªã©ã‚’å®Ÿè£…ã™ã‚‹ã¨ãã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’èª­ã¿è¾¼ã‚€ã¹ãã€LangChainã®File Loadersã‚’åˆ©ç”¨ã™ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã¯å¤šã€…ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ãã®ä¸­ã§ã‚‚ `DirectoryLoader` ã‚„ `MultiFileLoader` ã¯è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ã¨ã‚ã¦èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¨ã¦ã‚‚ä¾¿åˆ©ãªã®ã§ã™ãŒ[^1] [^2]ã€ä»»æ„ã®æ‹¡å¼µå­ã«å¯¾å¿œã—ãŸã„ã¨ãã«å°‘ã—æ‚©ã‚“ã ãŸã‚ã€è§£æ±ºæ–¹æ³•ã‚’è¨˜è¼‰ã—ã¦ã„ãã¾ã™ã€‚

ä¾‹ãˆã°ã“ã¡ã‚‰ã® `DirectoryLoader` ã®å®Ÿè£…ã¯ã€ä¸€èˆ¬çš„ãªãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚„CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ã»ã‹ã«JavaScriptãªã©ã®æ‹¡å¼µå­ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ãŒã€ã»ã‹ã«ã‚‚è‰²ã€…ãªãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾å¿œã™ã‚‹ãŸã‚ã«æ‹¡å¼µå­ã‚’åˆ—æŒ™ã—ã¦ã„ãã¨ã‚­ãƒªãŒã‚ã‚Šã¾ã›ã‚“ã€‚

```typescript
const loader = new DirectoryLoader(directoryPath, {
  '.txt': (path) => new TextLoader(path),
  '.csv': (path) => new CSVLoader(path, 'text'),
  '.json': (path) => new JSONLoader(path, '/texts'),
  '.js': (path) => new TextLoader(path),
  '.ts': (path) => new TextLoader(path),
  '.jsx': (path) => new TextLoader(path),
  '.tsx': (path) => new TextLoader(path),
  // å¯¾å¿œã—ãŸã„æ‹¡å¼µå­ãŒç„¡æ•°ã«å­˜åœ¨ã™ã‚‹â€¦
})
```

ã¾ãŸLangChainã®å®Ÿè£…ã‚’è¦‹ã¦ã‚‚[^3]ã€ä»»æ„ã®æ‹¡å¼µå­ã‚’å‡¦ç†ã§ãã‚‹ã‚ˆã†ã«ã¯ãªã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚

ã¡ãªã¿ã«ä¸Šè¨˜ã®ä¾‹ã«ã¤ã„ã¦ã€ã‚‚ã—ã‹ã™ã‚‹ã¨ã€Œ `.js` ã‚„ `.ts` ã«ã¯ `TextLoader` ã˜ã‚ƒãªãã¦å°‚ç”¨ã®Loaderã‚’ä½¿ã£ãŸæ–¹ãŒè‰¯ããªã„ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãŠãŠã‚€ã­LLMãŒå„ç¨®æ–‡æ³•ã‚’ç†è§£ã—ã¦ãã‚Œã‚‹ã®ã§ã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦èª­ã¿è¾¼ã‚“ã§ã‚‚ãã“ã¾ã§å•é¡Œã¯ãªã„ã§ã™ã€‚

## è§£æ±ºæ–¹æ³•

ã¾ãšã¯ã€å½¢å¼ã‚’æŒ‡å®šã—ã¦èª­ã¿è¾¼ã¿ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å®šç¾©ã—ã¾ã™ã€‚

```typescript
const loaders = {
  '.txt': (path) => new TextLoader(path),
  '.csv': (path) => new CSVLoader(path, 'text'),
  '.json': (path) => new JSONLoader(path, '/texts'),
}
```

æ¬¡ã«ã€å®šç¾©ã•ã‚Œã¦ã„ãªã„æ‹¡å¼µå­ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦èª­ã¿è¾¼ã‚€ã‚ˆã†å®šç¾©ã—ã¾ã™ã€‚

```typescript
import { extname } from 'path'

const unknownLoaders = filePaths.reduce((object, path) => {
  const key = extname(path)  // æ‹¡å¼µå­ã‚’å–å¾—
  if (key in loaders) {
    return objectã€€ã€€// æ‹¡å¼µå­ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚¹ã‚­ãƒƒãƒ—
  }

  // æ‹¡å¼µå­ã”ã¨ã®èª­ã¿è¾¼ã¿ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ 
  return { ...object, [key]: (path: string) => new TextLoader(path) }
}, {})
```

æœ€å¾Œã«ã€ãã‚Œãã‚Œã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å±•é–‹ã—ã¦Loaderã‚’ä½œæˆã—ã¾ã™ã€‚

```typescript
const loader = new DirectoryLoader(directoryPath, { ...loaders, ...unknownLoaders })
const documents = await loader.load()  // [Document { pageContent: ...
```

:::message
LangChain.jsé–¢é€£ã®importæ–‡ã¯çœç•¥ã—ã¦ã„ã¾ã™ã€‚
:::

## è§£èª¬

ç‰¹ã«é›£ã—ã„ã“ã¨ã¯ã—ã¦ã„ãªã„ã®ã§ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§é ‚ã‘ã‚Œã°åˆ†ã‹ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚ `reduce()` ã‚„ `[key]` ãªã©ã¯ã‚ã¾ã‚Šä½¿ã‚ãªã„æ°—ãŒã™ã‚‹ã®ã§[^4] [^5]ã€å¼•ã£ã‹ã‹ã‚‹ã¨ã™ã‚Œã°ãã®è¾ºã‚Šã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã®éƒ¨åˆ†ã®å‚è€ƒè¨˜äº‹ã¯è„šæ³¨ã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã€ `.txt` , `.yml` , `.py` ã®3ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸ãˆã‚‰ã‚ŒãŸå ´åˆã€æœ€çµ‚çš„ã«Loaderã«å±•é–‹ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ `.txt` , `.csv` , `.json` ã®3ã¤ã«åŠ ãˆã€å¯¾å¿œã—ã¦ã„ãªã‹ã£ãŸ `.yml` , `.py` ã®LoaderãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

```typescript
{
  '.txt': (path) => new TextLoader(path),
  '.csv': (path) => new CSVLoader(path, 'text'),
  '.json': (path) => new JSONLoader(path, '/texts'),
  '.yml': (path) => new TextLoader(path),
  '.py': (path) => new TextLoader(path),
}
```

## ãŠã‚ã‚Šã«

æœ€è¿‘ã®ï¼ˆã¨ã„ã†ã»ã©ã§ã‚‚ãªã„ã§ã™ãŒï¼‰ç”ŸæˆAIã¾ã‚ã‚Šã®æŠ€è¡“ã¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒæ—©ãã¦æ¥½ã—ã„ã§ã™ã­ï¼Difyã‚„OpenAI Assistants APIã‚‚ã„ã„ã§ã™ãŒã€å€‹äººçš„ã«æœ€è¿‘ã¯Verel AI SDKã¨LangSmithã®2ã¤ãŒå¥½ãã§ã™ ğŸ”¥


[^1]: [DirectoryLoader | ğŸ¦œï¸ğŸ”— Langchain](https://js.langchain.com/v0.2/docs/integrations/document_loaders/file_loaders/directory)
[^2]: [Multiple individual files | ğŸ¦œï¸ğŸ”— Langchain](https://js.langchain.com/v0.2/docs/integrations/document_loaders/file_loaders/multi_file)
[^3]: [langchainjs/langchain/src/document_loaders/fs/directory.ts at main Â· langchain-ai/langchainjs](https://github.com/langchain-ai/langchainjs/blob/dbcf1671b00ff7516adf422fbaadd4d65857328e/langchain/src/document_loaders/fs/directory.ts#L100)
[^4]: [Array.prototype.reduce() - JavaScript | MDN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce)
[^5]: [JavaScriptã§Objectã®Keyã«å¤‰æ•°å±•é–‹ã™ã‚‹](https://zenn.dev/ry_km/articles/use-variables-with-object-key-in-js)
