---
title: "5åˆ†ã§å­¦ã¶OpenAI APIãƒãƒ³ã‚ºã‚ªãƒ³"
emoji: "ğŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [openai, chatgpt, llm]
published: true
published_at: "2023-10-02 17:30"
publication_name: "activecore"
---

## ã¯ã˜ã‚ã«

ã¯ã˜ã‚ã¾ã—ã¦ã€‚æ–°å’ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®winnieã§ã™ã€‚
ã“ã®åº¦ã‚ã§ãŸãã€ç¤¾å†…åˆã®LTå¤§ä¼šã‚’ä¸»å‚¬ã§ãã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸï¼

https://speakerdeck.com/yjn279/5fen-dexue-buopenai-api-hanzuon

è‡ªåˆ†ã‚‚LTã‚’ã™ã‚‹ã®ã§ã›ã£ã‹ããªã‚‰ã€ã¨ã„ã†è¨³ã§è©±ã™å†…å®¹ã‚’è¨˜äº‹ã«ã—ã¦ã¿ã¾ã™ã€‚ã¡ãªã¿ã«å½“åˆã¯ç™ºè¡¨10åˆ†ã‚’æƒ³å®šã—ã¦ã„ãŸã®ã§ã™ãŒã€å‚åŠ è€…ã®å¸Œæœ›ã«ã‚ˆã‚Š5åˆ†ã«ãªã‚Šã¾ã—ãŸã€‚

å€é€Ÿã§å–‹ã‚‰ãªã„ã¨â€¦ ğŸ˜±

:::message
äº‹å‰ã«ã€APIã‚­ãƒ¼ã®å–å¾—ã¨æ”¯æ‰•ã„æƒ…å ±ã®è¨­å®šã‚’ã—ã¦ãã ã•ã„[^1]ã€‚
ã¾ãŸã€ã“ã‚Œä»¥é™ã«å‡ºã¦ãã‚‹ `OPENAI_API_KEY` ã«ã¯ã”è‡ªèº«ã®ã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
:::

https://note.com/libproc/n/nc777ee0b3bf0

## OpenAIã¨ã¯ï¼Ÿ

OpenAIã¯ã€ChatGPTã‚’æä¾›ã™ã‚‹ä¼æ¥­ã§ã™[^2]ã€‚

GPTã‚’ã¯ã˜ã‚ã¨ã—ãŸã€ã•ã¾ã–ã¾ãªãƒ¢ãƒ‡ãƒ«ï¼ˆGPT-4 / DALLâ€¢E 2 / Whisper ãªã©ï¼‰ã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ¢ãƒ‡ãƒ«ã«ã¯ã€APIçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

## ã¯ã˜ã‚ã¦ã®OpenAI API

### Playgroundã‚’è©¦ã™

OpenAIã®ã‚µã‚¤ãƒˆã§ã¯ã€ç°¡å˜ã«APIã‚’è©¦ã™ãŸã‚ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™[^3]ã€‚ã¾ãšã¯ã€ã“ã¡ã‚‰ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ãŸã‚‰ã€æ—©é€ŸAPIã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

https://platform.openai.com/playground

### ã‚·ãƒ³ãƒ—ãƒ«ãªã‚„ã‚Šã¨ã‚Š

ã¾ãšã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ãªã‚„ã‚Šã¨ã‚Šã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

1. `USER` ã«ä¸‹è¨˜ã‚’å…¥åŠ›ã—ã¦é€ä¿¡ã™ã‚‹ã€‚
2. æ–‡ç« ã®ç¶šããŒ `ASSISTANT` ã«å‡ºåŠ›ã•ã‚Œã‚‹ã€‚
  
```javascript
ä»Šæ—¥ã¯æ™´ã‚Œã¦ã„ã¾ã™ã€‚ç©ºã®è‰²ã¯  // é’ã„ã§ã™ã€‚
```

ã“ã®ã‚ˆã†ã«ã€ `USER` ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§ã€ `ASSISTANT` ã‹ã‚‰æ–‡ç« ã®ç¶šãã‚’å‡ºåŠ›ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ãƒ¢ãƒ‡ãƒ«ã«ã€Œè¨­å®šã€ã‚’ä¸ãˆã‚‹

æ¬¡ã«ã€ç¬¬ä¸‰è€…è¦–ç‚¹ã§ã‚ã‚‹ `SYSTEM` ã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

1. `ASSISTANT` ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤ã™ã‚‹ã€‚
2. `SYSTEM` ã«ä¸‹è¨˜ã‚’å…¥åŠ›ã—ã¦å†åº¦é€ä¿¡ã™ã‚‹ã€‚

```javascript
ä¸€æ–‡ã§ç­”ãˆã¦ãã ã•ã„ã€‚ä»Šã¯å¤•æš®ã‚Œæ™‚ã§ã™ã€‚  // ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã«æŸ“ã¾ã£ã¦ã„ã¾ã™ã€‚
```

ã“ã®ã‚ˆã†ã«ã€ `SYSTEM` ã«ã¯çŠ¶æ³è¨­å®šãªã©ã‚’ä¼ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ä¼šè©±ã‚’ç¶šã‘ã‚‹

ã§ã¯ã€ChatGPTã®ã‚ˆã†ãªå¯¾è©±çš„ãªç”Ÿæˆã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

1. `USER` ã«ä¸‹è¨˜ã‚’å…¥åŠ›ã—ã¦é€ä¿¡ã™ã‚‹ã€‚

```javascript
å¾Œã‚ã®ç©ºã¯  // å¾ã€…ã«æš—ããªã£ã¦ã„ã¾ã™ã€‚
```

ä»¥å‰ã«å¯¾è©±ã—ãŸæƒ…å ±ã‚’æ®‹ã—ã¦ãŠãã“ã¨ã§ã€å¯¾è©±çš„ãªæ–‡ç« ç”Ÿæˆã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

### ã‚³ãƒ¼ãƒ‰ã‚’çœºã‚ã‚‹

ç¶šã„ã¦ã€ä»Šã¾ã§ã®å¯¾è©±ã‚’ã‚³ãƒ¼ãƒ‰ã§è¦‹ã¦ã¿ã¾ã™ã€‚

1. å³ä¸Šã® â€œView Codeâ€ ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚
2. â€œcurlâ€ ã‚’é¸æŠã™ã‚‹ã€‚

`messages` ã®é…åˆ—ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚ã“ã“ã§ã¯ã€å…ˆã»ã©ã®å¯¾è©±ã‚’é…åˆ—ã¨ã—ã¦æ¸¡ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚ã“ã®ã‚ˆã†ã«ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é…åˆ—ï¼ˆã¨ãƒ¢ãƒ‡ãƒ«åï¼‰ã‚’JSONã¨ã—ã¦é€ä¿¡ã™ã‚‹ã ã‘ã§ã€APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```json
{
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "system",
      "content": "ä¸€æ–‡ã§ç­”ãˆã¦ãã ã•ã„ã€‚ä»Šã¯å¤•æš®ã‚Œæ™‚ã§ã™ã€‚"
    },
    {
      "role": "user",
      "content": "ä»Šæ—¥ã¯æ™´ã‚Œã¦ã„ã¾ã™ã€‚ç©ºã®è‰²ã¯"
    },
    {
      "role": "assistant",
      "content": "ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã«æŸ“ã¾ã£ã¦ã„ã¾ã™ã€‚"
    },
    {
      "role": "user",
      "content": "å¾Œã‚ã®ç©ºã¯"
    },
    {
      "role": "assistant",
      "content": "å¾ã€…ã«æš—ããªã£ã¦ã„ã¾ã™ã€‚"
    }
  ]
}
```

:::details ã‚³ãƒ¼ãƒ‰

```shell
curl https://api.openai.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -d '{
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "system",
      "content": "ä¸€æ–‡ã§ç­”ãˆã¦ãã ã•ã„ã€‚ä»Šã¯å¤•æš®ã‚Œæ™‚ã§ã™ã€‚"
    },
    {
      "role": "user",
      "content": "ä»Šæ—¥ã¯æ™´ã‚Œã¦ã„ã¾ã™ã€‚ç©ºã®è‰²ã¯"
    },
    {
      "role": "assistant",
      "content": "ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã«æŸ“ã¾ã£ã¦ã„ã¾ã™ã€‚"
    },
    {
      "role": "user",
      "content": "å¾Œã‚ã®ç©ºã¯"
    },
    {
      "role": "assistant",
      "content": "å¾ã€…ã«æš—ããªã£ã¦ã„ã¾ã™ã€‚"
    }
  ],
  "temperature": 0,
  "max_tokens": 256,
  "top_p": 1,
  "frequency_penalty": 0,
  "presence_penalty": 0
}'
```

:::

### APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹

ã§ã¯å®Ÿéš›ã«ã€APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

1. `messages` é…åˆ—ã®æœ€å¾Œã®è¦ç´ ã‚’å‰Šé™¤ã™ã‚‹ã€‚
2. ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã€‚

```json: request.json
{
  "messages": [
    {
      "role": "system",
      "content": "ä¸€æ–‡ã§ç­”ãˆã¦ãã ã•ã„ã€‚ä»Šã¯å¤•æš®ã‚Œæ™‚ã§ã™ã€‚"
    },
    {
      "role": "user",
      "content": "ä»Šæ—¥ã¯æ™´ã‚Œã§ã™ã€‚ç©ºã®è‰²ã¯"
    },
    {
      "role": "assistant",
      "content": "ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã«æŸ“ã¾ã£ã¦ã„ã¾ã™ã€‚"
    },
    {
      "role": "user",
      "content": "å¾Œã‚ã®ç©ºã¯"
    }
  ]
}
```

:::details ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```shell
curl https://api.openai.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -d '{
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "system",
      "content": "ä¸€æ–‡ã§ç­”ãˆã¦ãã ã•ã„ã€‚ä»Šã¯å¤•æš®ã‚Œæ™‚ã§ã™ã€‚"
    },
    {
      "role": "user",
      "content": "ä»Šæ—¥ã¯æ™´ã‚Œã§ã™ã€‚ç©ºã®è‰²ã¯"
    },
    {
      "role": "assistant",
      "content": "ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã«æŸ“ã¾ã£ã¦ã„ã¾ã™ã€‚"
    },
    {
      "role": "user",
      "content": "å¾Œã‚ã®ç©ºã¯"
    }
  ],
  "temperature": 1,
  "max_tokens": 256,
  "top_p": 1,
  "frequency_penalty": 0,
  "presence_penalty": 0
}'
```

:::

```json: response.json
{
  "message": {
    "role": "assistant",
    "content": "å¾ã€…ã«æš—ããªã‚Šã¤ã¤ã‚ã‚Šã¾ã™ã€‚"
  }
}
```

:::details ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```json
{
  "id": "chatcmpl-80hTiakDk7iP3oKfowmFeUf7R1PXe",
  "object": "chat.completion",
  "created": 1695177822,
  "model": "gpt-3.5-turbo-0613",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "å¾ã€…ã«æš—ããªã‚Šã¤ã¤ã‚ã‚Šã¾ã™ã€‚"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 67,
    "completion_tokens": 15,
    "total_tokens": 82
  }
}
```

:::

Playgroundã¨åŒæ§˜ã«ã€æ–‡ç« ã®ç¶šãã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸï¼

## Function Calling

Function Callingã¨ã¯ã€ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰é–¢æ•°ã‚’å‘¼ã³å‡ºã›ã‚‹æ©Ÿèƒ½ã®ã“ã¨ã§ã™ã€‚

### æœ€æ–°ã®æƒ…å ±ã‚’å‡ºåŠ›ã—ã¦ã¿ã‚‹

ã¾ãšã¯ã€æ˜æ—¥ã®æœ€é«˜æ°—æ¸©ã‚’å‡ºåŠ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

1. ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦æ¸¡ã™ã€‚
2. ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã€‚

```javascript
ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©ã¯  // ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒâ€¦
```

:::details ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```shell
curl https://api.openai.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -d '{
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "user",
      "content": "ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©ã¯"
    }
  ],
  "temperature": 0,
  "max_tokens": 256,
  "top_p": 1,
  "frequency_penalty": 0,
  "presence_penalty": 0
}'
```

:::

:::details ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```json
{
  "id": "chatcmpl-80lbbV7Rw5N11YRsJjmpC31VO05SO",
  "object": "chat.completion",
  "created": 1695193687,
  "model": "gpt-3.5-turbo-0613",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒã€ç§ã¯æƒ…å ±ã‚’æä¾›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚æœ€é«˜æ°—æ¸©ã¯åœ°åŸŸã‚„æ™‚æœŸã«ã‚ˆã£ã¦ç•°ãªã‚‹ãŸã‚ã€å…·ä½“çš„ãªå ´æ‰€ã‚„æ—¥ä»˜ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã‚Œã°ã€ãŠæ‰‹ä¼ã„ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 16,
    "completion_tokens": 86,
    "total_tokens": 102
  }
}
```

:::

ã§ãã¾ã›ã‚“ã€‚ãƒ¢ãƒ‡ãƒ«ã¯æœ€æ–°ã®æƒ…å ±ã‚’å­¦ç¿’ã—ã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚

### è‡ªä½œé–¢æ•°ã‚’æ¸¡ã™

ã“ã‚Œã¯ã€Function Callingã®æ©Ÿèƒ½ã§å®Ÿç¾ã§ãã¾ã™ã€‚æ°—æ¸©ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰å–å¾—ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…ã—[^4]ã€Function Callingã§å‘¼ã³å‡ºã›ã°è‰¯ã„ã®ã§ã™ã€‚

```python
# å®Ÿè£…ã—ãŸé–¢æ•°
get_max_temperature(35.6895, 139.6917)  # 30.3
```

:::details ã‚³ãƒ¼ãƒ‰

```python
import json
import urllib

def get_max_temperature(latitude, longitude):
    """ç·¯åº¦ã¨çµŒåº¦ã‚’å—ã‘å–ã‚Šã€ãã®åœ°ç‚¹ã®æœ€é«˜æ°—æ¸©ã‚’è¿”ã™ã€‚"""
    
    # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    URL = "https://api.open-meteo.com/v1/forecast?"
    query = urllib.parse.urlencode({
        "latitude": latitude,
        "longitude": longitude,
        "hourly": "temperature_2m",
    })
    
    # ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    req = urllib.request.Request(URL + query)
    with urllib.request.urlopen(req) as res:
        body = json.load(res)
        temperature_list = body["hourly"]["temperature_2m"]
    
    return max(temperature_list)
```

:::

`functions` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«è‡ªä½œã—ãŸé–¢æ•°ã‚’æ¸¡ã—ã€å†åº¦APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã¿ã¾ã™ã€‚

```json: request.json
{
  "model": "gpt-3.5-turbo",
  "messages": [
    {"role": "user", "content": "ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©ã¯"},
  ],
  // å®Ÿè£…ã—ãŸé–¢æ•°ã‚’æ¸¡ã™
  "functions": [
    {
      "name": "get_max_temperature",
      "description": "ç·¯åº¦ã¨çµŒåº¦ã‚’å—ã‘å–ã‚Šã€ãã®åœ°ç‚¹ã®æœ€é«˜æ°—æ¸©ã‚’è¿”ã™ã€‚",
      "parameters": {
        "type": "object",
        "properties": {
          "latitude": {
            "type": "number",
            "description": "æœ€é«˜æ°—æ¸©ã‚’å–å¾—ã™ã‚‹åœ°ç‚¹ã®ç·¯åº¦"
          },
          "longitude": {
            "type": "number",
            "description": "æœ€é«˜æ°—æ¸©ã‚’å–å¾—ã™ã‚‹åœ°ç‚¹ã®çµŒåº¦"
          }
        },
        "required": ["latitude", "longitude"]
      }
    }
  ]
}
```

::::details ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```python
import json
import urllib

# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
URL = "https://api.openai.com/v1/chat/completions"

headers = {
    "content-type": "application/json",
    "Authorization": f"Bearer {OPENAI_API_KEY}",
}

data = json.dumps({
    "model": "gpt-3.5-turbo",
    "messages": [
        {"role": "user", "content": "ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©ã¯"},
    ],
    "functions": [
        {
            # å®Ÿè£…ã—ãŸé–¢æ•°ã‚’æ¸¡ã™
            "name": "get_max_temperature",
            "description": "ç·¯åº¦ã¨çµŒåº¦ã‚’å—ã‘å–ã‚Šã€ãã®åœ°ç‚¹ã®æœ€é«˜æ°—æ¸©ã‚’è¿”ã™ã€‚",
            "parameters": {
                "type": "object",
                "properties": {
                    "latitude": {
                        "type": "number",
                        "description": "æœ€é«˜æ°—æ¸©ã‚’å–å¾—ã™ã‚‹åœ°ç‚¹ã®ç·¯åº¦",
                    },
                    "longitude": {
                        "type": "number",
                        "description": "æœ€é«˜æ°—æ¸©ã‚’å–å¾—ã™ã‚‹åœ°ç‚¹ã®çµŒåº¦",
                    },
                },
                "required": ["latitude", "longitude"],
            },
        },
    ],
    "temperature": 0,
    "max_tokens": 256,
    "top_p": 1,
    "frequency_penalty": 0,
    "presence_penalty": 0,
}).encode()

# ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
req = urllib.request.Request(URL, data, headers)
with urllib.request.urlopen(req) as res:
    body = json.load(res)
    pprint(body)
```

:::message
Pythonã«ã¯OpenAIã®å…¬å¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ãŒã€ä»Šå›ã¯é€æ˜æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã«æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
:::

::::

é–¢æ•°ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®å¼•æ•° `arguments` ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ãªãŠã€ã“ã®ã¨ãã® `content` ã¯ `null` ã«ãªã£ã¦ã„ã¾ã™ã€‚
  
```json: response.json
"message": {
  "content": null,
  "function_call": {
    "arguments": {
      "latitude": 35.6895,
      "longitude": 139.6917
    },
    "name": "get_max_temperature"
  },
  "role": "assistant"
}
```

:::details ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```json
{
  "choices": [
    {
      "finish_reason": "function_call",
      "index": 0,
      "message": {
        "content": null,
        "function_call": {
          "arguments": {
            "latitude": 35.6895,
            "longitude": 139.6917
          },
          "name": "get_max_temperature"
        },
        "role": "assistant"
      }
    }
  ],
  "created": 1695204618,
  "id": "chatcmpl-80oRugzV0CMDStAzjYVwbAaXaiIf1",
  "model": "gpt-3.5-turbo-0613",
  "object": "chat.completion",
  "usage": {
    "completion_tokens": 29,
    "prompt_tokens": 117,
    "total_tokens": 146
  }
}
```

:::

### ã‚‚ã†ä¸€åº¦è©¦ã™

ã“ã®å¼•æ•°ã‚’ä½¿ã„ã€å†åº¦æ°—æ¸©ã‚’å‡ºåŠ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã¾ãšã¯å¼•æ•°ã‚’é–¢æ•°ã«æ¸¡ã—ã€ãã®è¿”ã‚Šå€¤ã‚’ `FUNCTION` ã¨ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«çµ„ã¿è¾¼ã¿ã¾ã™ã€‚

```python: request.py
get_max_temperature(35.6895, 139.6917)  # 30.3
```

```json: request.json
{
  "messages": [
    {
      "role": "user",
      "content": "ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©ã¯"
    },
    {
      "role": "function",
      "name": "get_max_temperature",
      "content": 30.3  // é–¢æ•°ã®è¿”ã‚Šå€¤
    }
  ]
}
```

::::details ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```python
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
URL = "https://api.openai.com/v1/chat/completions"

headers = {
    "content-type": "application/json",
    "Authorization": f"Bearer {OPENAI_API_KEY}",
}

data = json.dumps({
    "model": "gpt-3.5-turbo",
    "messages": [
        {
            "role": "user",
            "content": "ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©ã¯",
        },
        {
            "role": "function",
            "name": "get_max_temperature",
            "content": f"{get_max_temperature(35.6895, 139.6917)}",  # å®Ÿè£…ã—ãŸé–¢æ•°
        },
    ],
    "temperature": 0,
    "max_tokens": 256,
    "top_p": 1,
    "frequency_penalty": 0,
    "presence_penalty": 0,
}).encode()

# ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
req = urllib.request.Request(URL, data, headers)
with urllib.request.urlopen(req) as res:
    body = json.load(res)
    print(body)
```

:::message
ãƒ¢ãƒ‡ãƒ«ã¯æ¸¡ã—ãŸé–¢æ•°ã‚’å¿…ãšä½¿ã†ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€å®Ÿéš›ã«ã¯å‘¼ã³å‡ºã•ã‚ŒãŸé–¢æ•°ã‚’åˆ¤åˆ¥ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚
:::

::::

è¿”ã‚Šå€¤ã«ç¶šãæ–‡ç« ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚

```json: response.json
{
  "message": {
    "content": "åº¦ã§ã™ã€‚",
    "role": "assistant"
  }
}
```

:::details ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```json
{
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "message": {
        "content": "åº¦ã§ã™ã€‚",
        "role": "assistant"
      }
    }
  ],
 "created": 1695214394,
 "id": "chatcmpl-80qzaPCDwtHlt6lDOrodBKj2bCVbi",
 "model": "gpt-3.5-turbo-0613",
 "object": "chat.completion",
 "usage": {
    "completion_tokens": 3,
    "prompt_tokens": 25,
    "total_tokens": 28
  }
}
```

:::

ã“ã“ã¾ã§ã®å¯¾è©±ã‚’ç¹‹ã’ã¦æ–‡ç« ã«ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```text
ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©ã¯30.3åº¦ã§ã™ã€‚
```

ç„¡äº‹ã€æœ€é«˜æ°—æ¸©ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã­ï¼

## ãŠã‚ã‚Šã«

ä»Šå›ã¯åŸºæœ¬çš„ãªChat APIã«åŠ ãˆã¦ã€Function Callingã®æ©Ÿèƒ½ã«ã‚‚è§¦ã‚ŒãŸãƒãƒ³ã‚ºã‚ªãƒ³ã‚’è¨˜äº‹ã«ã—ã¾ã—ãŸã€‚Function Callingã¯å°‘ã—ã ã‘ã‚„ã‚„ã“ã—ã„ã§ã™ãŒã€ä½¿ã„ã“ãªã›ã‚Œã°ã‹ãªã‚Šå®Ÿç¾ã§ãã‚‹ã“ã¨ãŒåºƒãŒã‚Šã¾ã™ã€‚ãœã²ç†è§£ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ã¦ã‹5åˆ†ã§å–‹ã‚‹ã®ç„¡ç†ã˜ã‚ƒã‚“ ğŸ˜‡

[^1]: [[è¶…åˆå¿ƒè€…å‘ã‘] ChatGPT(OpenAI)ã®API keyå–å¾—æ‰‹é †ï½œTodoONadaæ ªå¼ä¼šç¤¾](https://note.com/libproc/n/nc777ee0b3bf0)
[^2]: [OpenAI](https://openai.com/)
[^3]: [Playground - OpenAI API](https://platform.openai.com/playground)
[^4]: [ğŸŒ¤ï¸ Free Open-Source Weather API | Open-Meteo.com](https://open-meteo.com)
