---
title: "Slack APIã‚’GASã§æ‰±ãŠã†ã¨ã—ã¦ãƒãƒã£ãŸè©±"
emoji: "ğŸ¤–"
type: "tech"
topics:
  - "gas"
  - "js"
published: true
published_at: "2023-09-15 12:00"
publication_name: "activecore"
---


## ã¯ã˜ã‚ã«
ã“ã‚“ã«ã¡ã¯ã€‚æ–°å’ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®winnieã§ã™ ğŸ¥

ç ”ä¿®æœŸé–“ä¸­ã«ã€ç¤¾å†…ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿ƒé€²ã™ã‚‹ãŸã‚ã®ã‚¢ãƒ—ãƒªã‚’Slack API Ã— Google Apps Scriptï¼ˆGASï¼‰ã§é–‹ç™ºã—ã¾ã—ãŸã€‚ãã®éš›ã€APIã‹ã‚‰å–å¾—ã—ãŸå€¤ã‚’Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜ã™ã‚‹ã¨ã“ã‚ã§å°‘ã—ãƒãƒã£ãŸã®ã§ã€è¨˜äº‹ã«ã—ã¦ã¿ã¾ã™ã€‚


## æ¦‚è¦
Slackã§ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’IDã§ã¯ãªãé€ä¿¡æ—¥æ™‚ã¨ãƒãƒ£ãƒ³ãƒãƒ«ã®çµ„ã¿åˆã‚ã›ã§ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ `ts` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿[^1]ï¼ˆã‚‚ã—ãã¯ `message_ts` ã‚„[^2] `thread_ts` ãªã©[^3]ï¼‰ã§ç®¡ç†ã—ã¦ãŠã‚Šã€ã“ã‚Œã¯UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®å½¢å¼ã§ã™ã€‚

> The ts value is essentially the ID of the message, guaranteed unique within the context of a channel or conversation.
> They look like UNIX/epoch timestamps, hence ts, with specified milliseconds. But they're actually message IDs, even if they're partially composed in seconds-since-the-epoch.
> The ts of a message can be used in many operations such as replying to it in a thread, or modifying the message. But it can also be used to retrieve the message by itself.[^4]

ã“ã® `ts` ã‚’Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§ç®¡ç†ã—ã‚ˆã†ã¨ã—ãŸã®ã§ã™ãŒã€ä¿å­˜ã—ãŸå€¤ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå–å¾—ã§ããšã€æ™‚é–“ã‚’è²»ã‚„ã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

## çµè«–
Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§æ•°å€¤ã‚’15æ¡ã¾ã§ã—ã‹å…¥åŠ›ã§ããš[^5]ã€ `ts` ãŒåˆ‡ã‚Šæ¨ã¦ã‚‰ã‚Œã¦ã„ãŸã“ã¨ãŒåŸå› ã§ã—ãŸã€‚`.toString()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„[^6]ã€æ–‡å­—åˆ—ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã“ã¨ã§è§£æ±ºã—ã¾ã™ã€‚

```javascript
1677204291.513459  // å…ƒã®ts
1677204291.51345  // ä¿å­˜ã—ãŸtsï¼ˆä¿®æ­£å‰ï¼‰
'1677204291.513459'  // ä¿å­˜ã—ãŸtsï¼ˆä¿®æ­£å¾Œï¼‰
```

ã¡ãªã¿ã«ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®æ•°å€¤å‹ã¯å€ç²¾åº¦æµ®å‹•å°æ•°ç‚¹æ•°ã®ãŸã‚ã€64ãƒ“ãƒƒãƒˆ â†’ 15æ¡ã®ç²¾åº¦ã¨ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚


## ãŠã‚ã‚Šã«
è§£æ±ºæ–¹æ³•ã¯ç°¡å˜ã§ã—ãŸãŒã€ãƒ‘ãƒƒã¨è¦‹ã§åˆ‡ã‚Šæ¨ã¦ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‰ãªã‹ã£ãŸã®ã§æ„å¤–ã¨è‹¦æˆ¦ã—ã¾ã—ãŸã€‚æ™®æ®µã¯Pythonã‚„JavaScriptã—ã‹è§¦ã‚‰ãªã„ã®ã§ã€å°æ•°ç‚¹ã®ç²¾åº¦ã‚’æ°—ã«ã—ãŸã“ã¨ã‚‚ãªã‹ã£ãŸã§ã™ã€‚

IDã¯æ–‡å­—åˆ—ã§ä¿å­˜ã™ã‚‹ã®ãŒãƒ™ã‚¿ãƒ¼ã§ã™ã­ï¼

[^1]: [message event | Slack](https://api.slack.com/events/message#subtypes)
[^2]: [chat.getPermalink method | Slack](https://api.slack.com/methods/chat.getPermalink#arg_message_ts)
[^3]: [Reference: Message payloads | Slack](https://api.slack.com/reference/messaging/payload)
[^4]: [Retrieving messages | Slack](https://api.slack.com/messaging/retrieving#individual_messages)
[^5]: [å˜ç²¾åº¦æµ®å‹•å°æ•°ç‚¹(æœ‰åŠ¹æ¡æ•°15æ¡)ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã€‘ | EGUWEB](https://eguweb.jp/googlesheet/64866/)
[^6]: [Google Apps Scriptã§Stringå‹æ–‡å­—åˆ—ã‚’æ•°å€¤ã«å¤‰æ›ã™ã‚‹æ–¹æ³•(æ•°å€¤â†’æ–‡å­—åˆ—ã‚‚) | AutoWorkerã€œGoogle Apps Script(GAS)ã¨Sikuliã§å§‹ã‚ã‚‹æ¥­å‹™æ”¹å–„å…¥é–€](https://auto-worker.com/blog/?p=920#)
